autoinvestor:
  domain: ${AUTOINVESTOR_URI}
  tokenCookieName: "access_token"
  okta:
    redirectUri: "${autoinvestor.domain}/api/auth/callback"
  client:
    users:
      url: "${USERS_BASE_URL}"
    oauth2:
      url: "${OKTA_RESOURCE_SERVER_URI}/v1"
      authorization:
        basic:
          username: ${OKTA_CLIENT_ID}
          password: ${OKTA_CLIENT_SECRET}

spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: "${OKTA_RESOURCE_SERVER_URI}"

  cloud:
    gateway:
      routes:
        - id: plain-text-response
          uri: "no://localhost"
          predicates:
            - Path=/
          filters:
            - SetStatus=200

        - id: plain-text-response
          uri: "no://localhost"
          predicates:
            - Path=/api
          filters:
            - SetStatus=200

        - id: register-hook
          uri: "forward:/hook/register"
          predicates:
            - Path=/api/hook/register
          filters:
            - AuthorizeHook

        - id: token-hook
          uri: "forward:/hook/token"
          predicates:
            - Path=/api/hook/token
          filters:
            - AuthorizeHook

        - id: okta-login-redirect
          uri: "forward:/auth/login"
          predicates:
            - Path=/api/auth/login

        - id: okta-login-callback
          uri: "forward:/auth/callback"
          predicates:
            - Path=/api/auth/callback

        - id: get-user-endpoint
          uri: "${USERS_BASE_URL}"
          predicates:
            - Path=/api/user
            - Method=GET
          filters:
            - Authorize
            - ClaimToHeader=userId,X-User-Id
            - RewritePath=/api/user,/user
