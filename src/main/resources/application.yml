spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: "${OKTA_RESOURCE_SERVER_URI}"

  cloud:
    gateway:
      routes:
        - id: plain-text-response
          uri: "no://localhost"
          predicates:
            - Path=/
          filters:
            - RewritePath=/, /actuator/health

        - id: plain-text-response
          uri: "no://localhost"
          predicates:
            - Path=/api/actuator/**
          filters:
            - RewritePath=/(?<segment>.*), /actuator/${segment}

        - id: allow-inline-hook-access
          uri: "forward:/internal-endpoint"
          predicates:
            - Path=/api/inlineHook

        - id: secure-portfolio-requests
          uri: "${USERS_BASE_URL}"
          predicates:
            - Path=/api/users/**
          filters:
            - Authorize
            - ClaimToHeader=userId,X-User-Id
            - RewritePath=/(?<segment>.*), /${segment}

autoinvestor:
  client:
    users:
      url: "${USERS_BASE_URL}"